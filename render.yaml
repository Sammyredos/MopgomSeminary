services:
  - type: web
    name: mopgomseminary
    env: node
    plan: free
    region: oregon
    # Optimized for real-time features and QR scanning
    autoDeploy: true
    previewsEnabled: false
    healthCheckPath: /api/health
    buildCommand: |
      echo "üöÄ Starting Mopgomyouth production build process..." &&
      echo "üì¶ Installing dependencies..." &&
      npm ci &&
      echo "üîß Generating Prisma client for PostgreSQL..." &&
      npx prisma generate &&
      echo "üóÑÔ∏è Setting up production database..." &&
      npx tsx scripts/setup-production-db.ts &&
      echo "‚úÖ Production database ready with email history" &&
      echo "üßπ Cleaning up placeholder platoon data..." &&
      npx tsx scripts/cleanup-placeholder-platoons.ts &&
      echo "‚úÖ Placeholder data cleanup completed" &&
      echo "üëë Setting up Super Admin account..." &&
      (npx tsx scripts/create-super-admin.ts && echo "‚úÖ Super Admin account ready (s.obadina@mopgomts.com)" || echo "‚ö†Ô∏è Admin creation skipped (may already exist)") &&
      echo "‚öôÔ∏è Seeding system settings..." &&
      (npx tsx scripts/seed-settings.ts && echo "‚úÖ Settings seeded successfully" || echo "‚ö†Ô∏è Settings seeding skipped (may already exist)") &&
      echo "üîê Seeding notification and security settings..." &&
      (npx tsx scripts/seed-notification-security-settings.ts && echo "‚úÖ Notification and security settings seeded" || echo "‚ö†Ô∏è Notification/security seeding skipped") &&
      echo "üé® Updating branding and settings..." &&
      (npx tsx scripts/update-branding.ts && echo "‚úÖ Branding updated successfully" || echo "‚ö†Ô∏è Branding update skipped") &&
      echo "üë• Setting up roles and permissions..." &&
      (npx tsx scripts/create-staff-role.ts && echo "‚úÖ Roles and permissions configured" || echo "‚ö†Ô∏è Role setup skipped") &&
      echo "üèóÔ∏è Building Next.js application with production optimizations..." &&
      npm run build:render &&
      echo "üßπ Cleaning up development dependencies..." &&
      npm prune --production &&
      echo "üéâ Mopgomseminary production build completed successfully!" &&
      echo "üîó Your app will be available at: https://mopgomseminary.onrender.com" &&
      echo "üìä Build Summary:" &&
      echo "  ‚úÖ Dependencies installed and optimized" &&
      echo "  ‚úÖ Database schema deployed with PostgreSQL" &&
      echo "  ‚úÖ Admin account configured" &&
      echo "  ‚úÖ System settings initialized" &&
      echo "  ‚úÖ Branding and roles configured" &&
      echo "  ‚úÖ Next.js application built for production" &&
      echo "  ‚úÖ Production dependencies optimized" &&
      echo "  ‚úÖ QR scanner functionality enabled" &&
      echo "  ‚úÖ Attendance verification system ready" &&
      echo "  ‚úÖ Platoon allocation system ready" &&
      echo "  ‚úÖ Room allocation system ready" &&
      echo "üöÄ Ready for deployment!"
    startCommand: |
      echo "üåü Starting Mopgomyouth Youth Registration System..." &&
      echo "üîß Environment: Production" &&
      echo "üóÑÔ∏è Database: PostgreSQL" &&
      echo "üåê Starting server..." &&
      npm start
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: mopgomyouth-db
          property: connectionString
      - key: NODE_ENV
        value: production
      - key: NODE_VERSION
        value: 18.18.0
      - key: NEXT_TELEMETRY_DISABLED
        value: 1
      - key: PRISMA_GENERATE_SKIP_AUTOINSTALL
        value: true
      - key: SKIP_TYPE_CHECK
        value: true
      - key: SKIP_ENV_VALIDATION
        value: false
      - key: NEXTAUTH_SECRET
        generateValue: true
      - key: NEXTAUTH_URL
        value: https://mopgomseminary.onrender.com
      - key: QR_SECRET_KEY
        generateValue: true
      - key: JWT_SECRET
        generateValue: true
      - key: ENCRYPTION_KEY
        generateValue: true
      - key: REAL_TIME_STATS
        value: true
      - key: STAFF_REALTIME_ACCESS
        value: true
      - key: BRANCH_SELECTION_REQUIRED
        value: true
      - key: ANALYTICS_ENABLED
        value: true
      - key: SYSTEM_NAME
        value: Mopgomyouth
      - key: ORGANIZATION_NAME
        value: Mopgomglobal
      - key: SUPPORT_EMAIL
        value: s.obadina@mopgomts.com
      - key: DEFAULT_ADMIN_EMAIL
        value: s.obadina@mopgomts.com
      - key: DEFAULT_ADMIN_PASSWORD
        value: SuperAdmin123@
      - key: MINIMUM_AGE
        value: 13
      - key: REGISTRATION_OPEN
        value: true
      - key: ENABLE_SMS_NOTIFICATIONS
        value: false
      - key: ENABLE_EMAIL_NOTIFICATIONS
        value: true
      - key: QR_CODE_ENABLED
        value: true
      - key: AUTO_VERIFY_REGISTRATIONS
        value: false
      - key: ALLOW_DUPLICATE_REGISTRATIONS
        value: false
      - key: ENABLE_PARENTAL_PERMISSION
        value: true
      - key: ENABLE_EMERGENCY_CONTACTS
        value: true
      - key: ENABLE_MEDICAL_INFO
        value: true
      - key: ENABLE_DIETARY_RESTRICTIONS
        value: true
      - key: ENABLE_SPECIAL_NEEDS
        value: true
      - key: ENABLE_ACCOMMODATIONS
        value: true
      - key: ENABLE_ROOM_ALLOCATION
        value: true
      - key: ENABLE_PLATOON_ALLOCATION
        value: true
      - key: ENABLE_QR_VERIFICATION
        value: true
      - key: ENABLE_BULK_OPERATIONS
        value: true
      - key: ENABLE_ANALYTICS
        value: true
      - key: ENABLE_REPORTS
        value: true
      - key: ENABLE_NOTIFICATIONS
        value: true
      - key: ENABLE_USER_MANAGEMENT
        value: true
      - key: ENABLE_ROLE_MANAGEMENT
        value: true
      - key: ENABLE_SETTINGS_MANAGEMENT
        value: true
      - key: ENABLE_BACKUP_RESTORE
        value: true
      - key: ENABLE_AUDIT_LOGS
        value: true
      - key: ENABLE_REAL_TIME_UPDATES
        value: true
      - key: ENABLE_MOBILE_RESPONSIVE
        value: true
      - key: ENABLE_DARK_MODE
        value: false
      - key: ENABLE_MULTI_LANGUAGE
        value: false
      - key: DEFAULT_LANGUAGE
        value: en
      - key: DEFAULT_TIMEZONE
        value: America/Los_Angeles
      - key: DEFAULT_CURRENCY
        value: USD
      - key: ENABLE_PAYMENT_PROCESSING
        value: false
      - key: ENABLE_SOCIAL_LOGIN
        value: false
      - key: ENABLE_TWO_FACTOR_AUTH
        value: false
      - key: SESSION_TIMEOUT_MINUTES
        value: 60
      - key: MAX_LOGIN_ATTEMPTS
        value: 5
      - key: PASSWORD_MIN_LENGTH
        value: 8
      - key: REQUIRE_PASSWORD_COMPLEXITY
        value: true
      - key: ENABLE_PASSWORD_RESET
        value: true
      - key: ENABLE_ACCOUNT_LOCKOUT
        value: true
      - key: ENABLE_SECURITY_HEADERS
        value: true
      - key: ENABLE_RATE_LIMITING
        value: true
      - key: ENABLE_CORS
        value: true
      - key: ENABLE_COMPRESSION
        value: true
      - key: ENABLE_CACHING
        value: true
      - key: CACHE_TTL_SECONDS
        value: 300
      - key: ENABLE_MONITORING
        value: true
      - key: LOG_LEVEL
        value: info
      - key: ENABLE_DEBUG_MODE
        value: false
      # Email Configuration for Gmail
      - key: SMTP_HOST
        value: smtp.gmail.com
      - key: SMTP_PORT
        value: 465
      - key: SMTP_SECURE
        value: true
      - key: SMTP_USER
        value: samuel.obadina93@gmail.com
      - key: SMTP_PASS
        value: zcugqmuisrldyegf
      - key: EMAIL_FROM
        value: samuel.obadina93@gmail.com
      - key: EMAIL_FROM_NAME
        value: LINGER NO LONGER 6.0 Registration
      - key: ADMIN_EMAILS
        value: s.obadina@mopgomts.com
      - key: REDIS_URL
        value: redis://localhost:6379
      - key: CLOUDINARY_CLOUD_NAME
        value: change-me
      - key: CLOUDINARY_API_KEY
        value: change-me
      - key: CLOUDINARY_API_SECRET
        value: change-me
      - key: BACKUP_ENCRYPTION
        value: true
      - key: BACKUP_ENCRYPTION_KEY
        generateValue: true

databases:
  - name: mopgomyouth-db
    databaseName: mopgomyouth
    user: mopgomyouth_user
    plan: free
